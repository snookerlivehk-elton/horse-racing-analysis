<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>J18 å‘½ä¸­ç‡åˆ†æç¸½è¦½</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #1e1e1e;
            --bg-panel: #2d2d2d;
            --text-main: #e0e0e0;
            --text-muted: #a0a0a0;
            --accent-gold: #fbbf24;
            --accent-green: #10b981;
            --accent-blue: #3b82f6;
            --accent-red: #ef4444;
            --border-color: #404040;
        }

        body { 
            font-family: 'Roboto', sans-serif; 
            padding: 20px; 
            background-color: var(--bg-dark); 
            color: var(--text-main);
            margin: 0;
        }
        
        h1 { color: var(--accent-gold); text-align: center; margin-bottom: 30px; }

        .nav-bar {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
        }

        .nav-btn {
            background-color: #4b5563;
            color: white;
            padding: 10px 20px;
            text-decoration: none;
            border-radius: 4px;
            font-weight: bold;
            transition: opacity 0.2s;
        }

        .nav-btn:hover { opacity: 0.8; }

        .table-container {
            max-width: 1200px;
            margin: 0 auto;
            overflow-x: auto;
            background: var(--bg-panel);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        th, td {
            padding: 15px;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            color: var(--accent-gold);
            font-weight: bold;
            font-size: 1.1em;
            text-align: left;
        }

        td { font-size: 1em; }
        
        td:first-child { text-align: left; font-weight: bold; color: var(--accent-blue); }

        .rate-high { color: var(--accent-green); font-weight: bold; }
        .rate-mid { color: var(--accent-gold); }
        .rate-low { color: var(--text-muted); }

        .loading { text-align: center; font-size: 1.2em; color: var(--text-muted); margin-top: 50px; }
    </style>
</head>
<body>
    <div class="nav-bar">
        <a href="/" class="nav-btn">ğŸ  è¿”å›é¦–é </a>
        <a href="/analysis/daily" class="nav-btn">ğŸ“ˆ æ¯æ—¥è¶¨å‹¢</a>
        <a href="/analysis/speedpro-lab" class="nav-btn">ğŸ§ª SpeedPro å¯¦é©—å®¤</a>
    </div>

    <h1>ğŸ¯ ç­–ç•¥èˆ‡ J18 å‘½ä¸­ç‡åˆ†æç¸½è¦½</h1>

    <div id="loading" class="loading">è¼‰å…¥æ•¸æ“šä¸­...</div>

    <div id="dashboard" class="table-container" style="display: none;">
        <table>
            <thead>
                <tr>
                    <th width="25%">ä¾†æº (Source)</th>
                    <th width="10%">ç¸½å ´æ•¸</th>
                    <th width="15%">ç¨è´ (Win)<br><span style="font-size:0.8em; color:gray">Top 2 å«å† </span></th>
                    <th width="15%">é€£è´ (Q)<br><span style="font-size:0.8em; color:gray">Top 3 å«å† äº</span></th>
                    <th width="15%">ä¸‰é‡å½© (T)<br><span style="font-size:0.8em; color:gray">Top 4 å«å† äºå­£</span></th>
                    <th width="20%">å››é‡å½© (F4)<br><span style="font-size:0.8em; color:gray">Top 6 å«å‰å››</span></th>
                </tr>
            </thead>
            <tbody id="stats-body"></tbody>
        </table>
    </div>

    <script>
        async function loadStats() {
            try {
                const response = await fetch('/api/analysis/stats/hit-rates');
                const data = await response.json();
                
                // data is Record<string, Stats>
                const tbody = document.getElementById('stats-body');
                tbody.innerHTML = '';

                if (data && Object.keys(data).length > 0) {
                    const ignoredKeys = ['punditStats', 'compositeStats', 'trendStats', 'totalRaces'];
                    
                    Object.entries(data).forEach(([name, stats]) => {
                        // Filter out legacy keys and invalid structures
                        if (ignoredKeys.includes(name) || !stats || !stats.win) return;

                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td>${name}</td>
                            <td>${stats.totalRaces}</td>
                            <td class="${getColor(stats.win.rate)}">${stats.win.rate}% <span style="font-size:0.8em;color:#666">(${stats.win.hits})</span></td>
                            <td class="${getColor(stats.q.rate)}">${stats.q.rate}% <span style="font-size:0.8em;color:#666">(${stats.q.hits})</span></td>
                            <td class="${getColor(stats.t.rate)}">${stats.t.rate}% <span style="font-size:0.8em;color:#666">(${stats.t.hits})</span></td>
                            <td class="${getColor(stats.f4.rate)}">${stats.f4.rate}% <span style="font-size:0.8em;color:#666">(${stats.f4.hits})</span></td>
                        `;
                        tbody.appendChild(tr);
                    });

                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('dashboard').style.display = 'block';
                } else {
                    document.getElementById('loading').textContent = 'æš«ç„¡æ•¸æ“š';
                }
            } catch (error) {
                console.error('Error loading stats:', error);
                document.getElementById('loading').textContent = 'è¼‰å…¥å¤±æ•—: ' + error.message;
            }
        }

        function getColor(rate) {
            if (rate >= 50) return 'rate-high';
            if (rate >= 30) return 'rate-mid';
            return 'rate-low';
        }

        loadStats();
    </script>
</body>
</html>
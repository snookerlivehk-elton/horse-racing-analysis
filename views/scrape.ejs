<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HKJC é¦¬åŒ¹å¾€ç¸¾çˆ¬èŸ²çµæœ</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; background-color: #f4f4f9; }
        h1 { color: #333; text-align: center; }
        .meta-info { text-align: center; margin-bottom: 20px; color: #666; }
        .card { background: white; padding: 20px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.08); }
        .card-title { font-size: 1.1em; font-weight: bold; margin-bottom: 10px; border-bottom: 2px solid #eee; padding-bottom: 8px; color: #2c3e50; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 8px; text-align: center; border-bottom: 1px solid #ddd; font-size: 0.9em; }
        th { background-color: #f8f9fa; font-weight: 600; color: #555; }
        tr:hover { background-color: #f5f5f5; }
        .btn-bar { display: flex; justify-content: center; gap: 12px; margin-bottom: 20px; flex-wrap: wrap; }
        .btn { padding: 8px 16px; border-radius: 4px; border: none; cursor: pointer; font-size: 0.9em; }
        .btn-primary { background-color: #3498db; color: white; }
        .btn-secondary { background-color: #2ecc71; color: white; }
        .btn-link { background: none; color: #3498db; text-decoration: underline; padding: 0; }
        .error { color: #c0392b; text-align: center; margin-bottom: 10px; }
        .info { color: #16a085; text-align: center; margin-bottom: 10px; }
        .tag { display: inline-block; padding: 2px 8px; border-radius: 12px; background-color: #ecf0f1; font-size: 0.8em; margin-left: 6px; }
        .table-wrapper { max-height: 500px; overflow: auto; border: 1px solid #eee; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>ğŸ HKJC é¦¬åŒ¹å¾€ç¸¾çˆ¬èŸ²çµæœ</h1>
    <div class="meta-info">
        Server Version: <%= serverVersion %> |
        æœ€å¾Œçˆ¬å–æ™‚é–“:
        <% if (lastUpdated) { %>
            <%= new Date(lastUpdated).toLocaleString() %>
        <% } else { %>
            å°šæœªçˆ¬å–
        <% } %>
    </div>

    <% if (scrapeError) { %>
        <div class="error">æœ€è¿‘ä¸€æ¬¡çˆ¬èŸ²éŒ¯èª¤: <%= scrapeError %></div>
    <% } %>

    <div class="btn-bar">
        <form method="get" action="/scrape-data">
            <button class="btn btn-primary" type="submit">é‡æ–°çˆ¬å–æœ€æ–°æ’ä½é¦¬åŒ¹</button>
        </form>
        <button class="btn btn-secondary" type="button" onclick="downloadExcel()">ä¸€éµç”Ÿæˆ Excel ä¸¦ä¸‹è¼‰</button>
        <a href="/" class="btn-link">è¿”å›èµ°å‹¢åˆ†æé¦–é </a>
    </div>

    <div class="card">
        <div class="card-title">
            ç¸½è¦½
        </div>
        <% if (scrapeResult && scrapeResult.horses && scrapeResult.horses.length > 0) { %>
            <div class="info">
                æœ¬æ¬¡å…±çˆ¬å– <strong><%= scrapeResult.horses.length %></strong> åŒ¹é¦¬çš„å¾€ç¸¾è³‡æ–™
            </div>
            <table>
                <thead>
                    <tr>
                        <th>é¦¬åŒ¹ç·¨è™Ÿ (Horse ID)</th>
                        <th>é¦¬å</th>
                        <th>å¾€ç¸¾å ´æ¬¡æ•¸</th>
                    </tr>
                </thead>
                <tbody>
                    <% scrapeResult.horses.forEach(function(horse) { %>
                        <tr>
                            <td><%= horse.horseId %></td>
                            <td><%= horse.horseName %></td>
                            <td><%= horse.rows.length %></td>
                        </tr>
                    <% }); %>
                </tbody>
            </table>
        <% } else { %>
            <div class="info">ç›®å‰æ²’æœ‰å¯é¡¯ç¤ºçš„çˆ¬èŸ²çµæœï¼Œè«‹å…ˆåŸ·è¡Œã€Œé‡æ–°çˆ¬å–æœ€æ–°æ’ä½é¦¬åŒ¹ã€ã€‚</div>
        <% } %>
    </div>

    <% if (scrapeResult && scrapeResult.horses && scrapeResult.horses.length > 0) { %>
        <div class="card">
            <div class="card-title">
                éƒ¨åˆ†æ¨£æœ¬æ˜ç´°
                <span class="tag">åƒ…å±•ç¤ºå‰ 1 åŒ¹é¦¬ä»¥ä¾›å¿«é€Ÿæª¢è¦–</span>
            </div>
            <% const sampleHorse = scrapeResult.horses[0]; %>
            <div class="info">
                é¦¬åŒ¹: <strong><%= sampleHorse.horseName %></strong> (<%= sampleHorse.horseId %>)ï¼Œ
                å¾€ç¸¾å ´æ¬¡: <strong><%= sampleHorse.rows.length %></strong>
            </div>
            <% if (sampleHorse.rows.length > 0) { %>
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <% 
                                const maxColumns = sampleHorse.rows.reduce(function(max, row) {
                                    return Math.max(max, row.columns.length);
                                }, 0);
                                const headers = [
                                    "å ´æ¬¡", "åæ¬¡", "æ—¥æœŸ", "è·‘é“/è³½é“", "è·¯ç¨‹", 
                                    "å ´åœ°", "ç­æ¬¡", "æª”ä½", "è©•åˆ†", "ç·´é¦¬å¸«", 
                                    "é¨å¸«", "é ­é¦¬è·é›¢", "ç¨è´è³ ç‡", "å¯¦éš›è² ç£…", 
                                    "æ²¿é€”èµ°ä½", "å®Œæˆæ™‚é–“", "é¦¬åŒ¹é«”é‡", "é…å‚™"
                                ];
                                for (var i = 0; i < maxColumns; i++) { 
                            %>
                                <th>
                                    <% if (i < headers.length) { %>
                                        <%= headers[i] %>
                                    <% } else { %>
                                        Col <%= i + 1 %>
                                    <% } %>
                                </th>
                            <% } %>
                            </tr>
                        </thead>
                        <tbody>
                            <% sampleHorse.rows.forEach(function(row) { %>
                                <tr>
                                    <% for (var i = 0; i < maxColumns; i++) { %>
                                        <td><%= row.columns[i] || '' %></td>
                                    <% } %>
                                </tr>
                            <% }); %>
                        </tbody>
                    </table>
                </div>
            <% } else { %>
                <div class="info">æ­¤é¦¬ç›®å‰æ²’æœ‰å¯é¡¯ç¤ºçš„å¾€ç¸¾ç´€éŒ„ã€‚</div>
            <% } %>
        </div>
    <% } %>

    <script>
        function downloadExcel() {
            window.location.href = '/scrape-data/excel';
        }
    </script>
</body>
</html>

